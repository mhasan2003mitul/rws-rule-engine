package nl.rws.re.rules.dakkapel;
import nl.rws.re.facts.dakkapelx.Grondslag;
import nl.rws.re.facts.dakkapelx.GrondslagBeschrijving;
import nl.rws.re.facts.dakkapelx.GebruikerVragen;
import nl.rws.re.facts.dakkapelx.Vraag;
import nl.rws.re.facts.dakkapelx.Antwoord;
import nl.rws.re.facts.dakkapelx.DakkapelKant;
import nl.rws.re.facts.dakkapelx.RuleResultaat;
import nl.rws.re.facts.dakkapelx.RuleResultaat.ResultaatVoor;

import nl.rws.re.facts.dakkapelx.Error;
import nl.rws.re.facts.dakkapelx.ErrorMessage;

import java.util.List;
import java.util.Arrays
import java.util.ArrayList;

dialect  "mvel"

rule "Is 'Op een achterdakvlak' grondslag beslissing ontbekend?"
    when
        $grondslagRondom: Grondslag(grondslagBeschrijving == GrondslagBeschrijving.OP_EEN_ACHTERDAKVLAK.toString())
    then
        retract($grondslagRondom);
        Vraag vraag = new Vraag();
        vraag.setVraagId("3");
        insert(vraag);
end

rule "Is 'Op een zijdakvlak' grondslag beslissing ontbekend?"
    when
        $grondslagRondom: Grondslag(grondslagBeschrijving == GrondslagBeschrijving.OP_EEN_ZIJDAKVLAK.toString())
    then
        retract($grondslagRondom);
        Vraag vraag = new Vraag();
        vraag.setVraagId("3");
        insert(vraag);
end

rule "Is 'Naar openbaar toegelijk gebied gekeerd' grondslag beslissing ontbekend?"
    when
        $grondslagRondom: Grondslag(grondslagBeschrijving == GrondslagBeschrijving.NAAR_OPENBAAR_TOEGELIJK_GEBIED_GEKEERD.toString(), definitieveBeslissing==null)
    then
        retract($grondslagRondom);
        Vraag vraag = new Vraag();
        vraag.setVraagId("4");
        insert(vraag);
end

rule "Rule voor JA beslissing voor Niet Zichtbaar Zijdakvlak"
    when
        $zijdakvlakVraag:Vraag(vraagId=="3",antwoord == DakkapelKant.ZIJKANT.name())
        $openbaarVraag:Vraag(vraagId=="4",antwoord == Antwoord.NEE.name())
    then
        retract($openbaarVraag);
        insert(new RuleResultaat(ResultaatVoor.NIET_ZICHTBAAR_ZIJDAKVLAK.name(), Antwoord.JA.name()));
end

rule "Rule voor Nee beslissing voor Niet Zichtbaar Zijdakvlak"
    when
        $zijdakvlakVraag:Vraag(vraagId=="3",antwoord!=null)
        $openbaarVraag:Vraag(vraagId=="4",antwoord!=null)
        (Vraag(vraagId=="3",antwoord!=null,antwoord != DakkapelKant.ZIJKANT.name()) or
        Vraag(vraagId=="4",antwoord !=null, antwoord != Antwoord.NEE.name()))
    then
        retract($openbaarVraag);
        insert(new RuleResultaat(ResultaatVoor.NIET_ZICHTBAAR_ZIJDAKVLAK.name(),Antwoord.NEE.name()));
end

rule "Rule voor JA beslissing voor Niet Zichtbaar dakvlak"
    when
        $achterdakvlakVraag:Vraag(vraagId=="3",antwoord != null)
        $preRuleResultaat:RuleResultaat(resultaatVoor == ResultaatVoor.NIET_ZICHTBAAR_ZIJDAKVLAK.name())
        (RuleResultaat(resultaatVoor == ResultaatVoor.NIET_ZICHTBAAR_ZIJDAKVLAK.name(), resultaat == Antwoord.JA.name()) or
        Vraag(vraagId=="3",antwoord == DakkapelKant.ACHTERKANT.name()))
    then
        retract($achterdakvlakVraag);
        retract($preRuleResultaat);
        insert(new RuleResultaat(ResultaatVoor.NIET_ZICHTBAAR_DAKVLAK.name(),Antwoord.JA.name()));
end

rule "Rule voor Nee beslissing voor Niet Zichtbaar dakvlak"
    when
        $preRuleResultaat: RuleResultaat(resultaatVoor == ResultaatVoor.NIET_ZICHTBAAR_ZIJDAKVLAK.name(),resultaat == Antwoord.NEE.name()) and
        $achterdakvlakVraag:Vraag(vraagId=="3",antwoord != DakkapelKant.ACHTERKANT.name())
    then
        retract($achterdakvlakVraag);
        retract($preRuleResultaat);
        insert(new RuleResultaat(ResultaatVoor.NIET_ZICHTBAAR_DAKVLAK.name(),Antwoord.NEE.name()));
end

rule "Rule voor JA beslissing voor Dakkapel in achterdakvlak"
    when
        $preRuleResultaat:RuleResultaat(resultaatVoor == ResultaatVoor.NIET_ZICHTBAAR_DAKVLAK.name(),resultaat == Antwoord.JA.name())
    then
        retract($preRuleResultaat);
        insert(new RuleResultaat(ResultaatVoor.DAKKAPEL_IN_ACHTERDAKVLAK.name() ,Antwoord.JA.name()));
end

rule "Rule voor Nee beslissing voor Dakkapel in achterdakvlak"
    when
        $preRuleResultaat:RuleResultaat(resultaatVoor == ResultaatVoor.NIET_ZICHTBAAR_DAKVLAK.name(),resultaat == Antwoord.NEE.name())
    then
        retract($preRuleResultaat);
        insert(new RuleResultaat(ResultaatVoor.DAKKAPEL_IN_ACHTERDAKVLAK.name(),Antwoord.NEE.name()));
end

rule "Rule voor JA beslissing voor Zichtbaar of niet"
    when
        $preRuleResultaat:RuleResultaat(resultaatVoor == ResultaatVoor.DAKKAPEL_IN_ACHTERDAKVLAK.name(),resultaat == Antwoord.JA.name())
    then
        retract($preRuleResultaat);
        insert(new RuleResultaat(ResultaatVoor.ZICHTBAAR_OF_NIET.name() ,Antwoord.JA.name()));
end

rule "Rule voor Nee beslissing voor Zichtbaar of niet"
    when
        $preRuleResultaat:RuleResultaat(resultaatVoor == ResultaatVoor.DAKKAPEL_IN_ACHTERDAKVLAK.name(),resultaat == Antwoord.NEE.name())
    then
        retract($preRuleResultaat);
        insert(new RuleResultaat(ResultaatVoor.ZICHTBAAR_OF_NIET.name(),Antwoord.NEE.name()));
end

rule "Rule voor JA beslissing voor Vergunningvrij"
    when
        $preRuleResultaat:RuleResultaat(resultaatVoor == ResultaatVoor.ZICHTBAAR_OF_NIET.name(),resultaat == Antwoord.JA.name())
    then
        retract($preRuleResultaat);
        insert(new RuleResultaat(ResultaatVoor.VOORWAARDEN_VERGUNNINGVRIJ.name(),Antwoord.JA.name()));
end

rule "Rule voor NEE beslissing voor Vergunningvrij"
    when
        $preRuleResultaat:RuleResultaat(resultaatVoor == ResultaatVoor.ZICHTBAAR_OF_NIET.name(),resultaat == Antwoord.NEE.name())
    then
        retract($preRuleResultaat);
        insert(new RuleResultaat(ResultaatVoor.VOORWAARDEN_VERGUNNINGVRIJ.name(),Antwoord.NEE.name()));
end
